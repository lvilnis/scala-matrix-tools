This code is a complete mess right now and needs to be overhauled and cleaned up.
